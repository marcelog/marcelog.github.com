<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>Ding annotations for dependency injection</title>
<meta name="Author" content="Marcelo Gornstein"/>
<meta name="Keywords" content="ding php di container dependency injection bean annotations"/>
<meta name="description" content="This article will take a look at the available annotations in the ding php dependency injection container"/>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../images/favicon.ico" title="favicon" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="all" />
<link href='../dphighlighter/SyntaxHighlighter.css' rel='stylesheet' type='text/css' />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="screen" href="../css/fix-ie.css" />
<![endif]-->
<!--[if IE 6]>
<script type="text/javascript" src="../js/fix-png.js"></script>
<![endif]-->
<script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script>
<script type="text/javascript" src="../js/lib/jquery-core.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
</head>
<body>
<div id="wrapper">
  <div id="top">
    <!-- <a class="logo" href="index.html">Marcelo G</a>-->
    <ul id="nav">
      <li><a href="../index.html"><span>Home</span></a></li>
      <li><a href="../about.html"><span>About</span></a></li>
      <li class="active"><a href="articles.html"><span>Articles</span></a></li>
      <li><a href="../software.html"><span>Software</span></a></li>
      <li><a href="mailto:marcelog@gmail.com"><span>Contact</span></a></li>
    </ul>
  </div>
  <div class="header">
  	<div class="line">
      <h1>Articles</h1>
      <div class="social-network">
       <a href="mailto:marcelog@gmail.com" class="icon-email" title="Email">Email</a>
       <g:plusone></g:plusone>
      </div>
   	</div>
    <div class="breadcrumb">You are here &nbsp;&raquo;&nbsp; <a href="../index.html">Home Page</a>  &nbsp;&raquo;&nbsp;  <a href="articles.html">Articles</a>  &nbsp;&raquo;&nbsp;  Ding annotations for dependency injection</div>
  </div>
  <div class="main-outer">
  	<div class="main-inner">
    	<div class="main">
      	<div class="line">
          <div id="content">
            <div class="mod simple article-detail-style">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
                <h2>Ding annotations for dependency injection</h2>
                <div class="hr-1"><hr /></div>
<p>
In the <a href="http://marcelog.github.com/articles/ding_component_bean_annotations.html">previous article</a> I've shown how to declare
your beans. Now it's time to see how to achieve DI (dependency injection), also using annotations.
</p>
<h3>@Resource</h3>
<p>
This annotation will inject a dependency based on its name (wire-by-name). Can be used on properties and setter methods. It's pretty cool, but you have
to know beforehand the name of the bean you want to inject. When used on a property, the name of the property will be used. When used on a
method, the method <b>MUST</b> be a setter, like "setDependency()". From such a method name, the container will try to find the bean named
"dependency". You can override this behaviour with the "name" argument.
</p>
<h4><b>Arguments</b></h4>
<ul>
<li><u>name</u>: A string. Optional. Specifies the name of the bean to be injected.
</li>
</ul>
<h4><b>Examples</b></h4>
<p>Using @Resource with properties: In the following example, both properties are injected with exactly the same
bean. The first one (without the "name" argument) will look a bean whose name is equal to the property name (in this
case, "dependency"). The second one, specifies that the name IS "dependency", so the name of the property wont matter at all.
</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    /** @Resource */
    protected $dependency;
    /** @Resource(name="dependency") */
    protected $myBean;
}
</pre>
<p>Now let's see how to use it in <b>setter methods</b> to inject properties.
In the first method (setDependency), the name of the bean is derived from the setter method itself, in this case, "dependency" is
the name of the bean. In the second method (setOtherStuff) the name is explicitely defined in the "name" argument:
</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    protected $dependency;
    protected $myBean;

    /** @Resource */
    public function setDependency($something)
    {
        $this->dependency = $something;
    }

    /** @Resource(name="dependency") */
    public function setOtherStuff($something)
    {
        $this->myBean = $something;
    }
}
</pre>
<h3>@Required</h3>
<p>This annotation enforces the configuration of a particular property. It can only be used on setter methods, and the container will
throw a BeanFactoryException if a @Required annotation is used on a setter method that is not configured to be injected with a property.</p>
<h4><b>Examples</b></h4>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    protected $myBean;

    /** @Required */
    public function setOtherStuff($something)
    {
        $this->myBean = $something;
    }
}
</pre>
<h3>@Value</h3>
<p>This annotation can be used on properties, constructors, and @Bean methods. It is used to specify an explicit value or a string that
resolves to a property injected in the container, either through the <a href="http://marcelog.github.com/Ding/manual/toc.html#config">PropertiesHolder</a>
bean or through the user properties set when instantiating the container.
</p>
<h4><b>Arguments</b></h4>
<ul>
<li><u>value</u>: A string. Required. A literal string to inject or a string that can be mapped to a property defined
in the container (in the format ${...}, like ${user.name}).
</li>
<li><u>name</u>: A string. Optional. When used in a property, there's no need to specify a name. Names are used when using
@Value on constructors and @Bean methods, that have multiple arguments. Thus, the "name" argument specifies the name of the argument
where to inject the specified string given in the "value" argument. If you dont specify the "name" argument, the order of the
@Value annotations, will be used to know what goes where.
</li>
</ul>
<h4><b>Examples</b></h4>
<p>Using it on a property. In this case, if the container has the property "user.name" (let's say it is set to
"nobody"), the property "string" will be set to "My username is nobody".</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    /** @Value(value="My username is ${user.name}") */
    protected $string;
}
</pre>
<p>
Using it on a constructor. In the following case, we have a constructor with 2 arguments, named "string1" and "string2". The first one
will be injected with the value of the property "user.name", and the second will be injected with the value of the property "user.group":
</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    protected $string1;
    protected $string2;

    /**
     * @Value(name="string1", value="${user.name}")
     * @Value(name="string2", value="${user.group}")
     */
    public function __construct($string1, $string2)
    {
        $this->string1 = $string1;
        $this->string2 = $string2;
    }
}
</pre>
<p>
The above example is equivalent to the next one (where the "name" argument is <b>not</b> specified):
</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    protected $string1;
    protected $string2;

    /**
     * @Value(value="${user.name}")
     * @Value(value="${user.group}")
     */
    public function __construct($string1, $string2)
    {
        $this->string1 = $string1;
        $this->string2 = $string2;
    }
}
</pre>
<p>For @Bean methods, the usage is similar to using it on a constructor method:</p>
<pre name="code" class="php">
/** @Configuration */
class MyBean
{
    /**
     * @Bean(class="AnotherBean")
     * @Value(value="${user.name}")
     * @Value(value="${user.group}")
     */
    public function anotherBean($string1, $string2)
    {
        return new AnotherBean($string1, $string2);
    }
}
</pre>
<h3>@Inject</h3>
<p>@Inject is the JSR330 counterpart to spring's @Autowired. This one can be used to inject your dependencies by type (instead of by name, like @Resource). It can be used
on properties, methods, and constructors. Using @Resource has the downside of having to use the name of the bean
you want to inject. Wiring by type, on the other hand, lets you have the container choose the appropiate bean you need
based just on its type. This will also result in a more strict type checking when injecting dependencies, something very valuable to have.
</p>
<h4><b>Arguments</b></h4>
<ul>
<li><u>type</u>: String. Required for properties and methods/constructors/@Bean methods whose arguments types are not defined. A type, is a string
that represents a class or interface full qualified name (without the leading \ for namespaces), like MyNameSpace\MyInterface. If this string contains
<b>[ ]</b> at the end (like MyNameSpace\MyInterface[]), an array will be injected instead of a scalar, with all the components that implement that interface or extends the given class.</li>
<li><u>required</u>: A boolean. Optional. "true" by default. By default, all @Inject dependencies are <b>required</b>, this means that the
container will throw an exception if it cant inject it. Specify "false" and the container will continue execution without injecting the
property (if no candidate was found or more than one was found and none of them are specified as a primary bean).</li>
<li><u>name</u>: A string. Optional. When used in a property, there's no need to specify a name. Names are used when using
@Inject on constructors and @Bean methods, that have multiple arguments. Thus, the "name" argument specifies the name of the argument
where to inject the dependency. If you dont specify the "name" argument, the order of the
@Inject annotations, will be used to know what goes where.
</li>
</ul>
<h4><b>Examples</b></h4>
<p>
Let's say you have defined an interface and a component that implements it, like:
</p>
<pre name="code" class="php">
interface IUserRepository
{
}

/** @Component */
class MyUserRepository implements IUserRepository
{
}
</pre>
<p>
And you want another component to be injected with any component that implements it:
</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    /** @Inject(type="IUserRepository") */
    protected $oneRepository;
}
</pre>
<p>The property "oneRepository" will contain an instance of MyUserRepository. If more than one component is found as a candidate to be injected (i.e: more than 1 component implements IUserRepository),
the container will throw an exception, because it cant decide by itself which one to inject. In this case, you can opt to use
something like @Resource to specify a name. But you can also decide to inject all the components found instead of just one:
</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    /** @Inject(type="IUserRepository[]") */
    protected $manyRepositories;
}
</pre>
<p>
In the above case, the property "manyRepositories" will be an array of all the components that implements IUserRepository.
</p>
<p>
If you still need one and not all of the candidate components to be injected, you can specify @Primary in the interesting components:
</p>
<pre name="code" class="php">
interface IUserRepository
{
}

/** @Component */
class MyUserRepository implements IUserRepository
{
}
/**
 * @Component
 * @Primary
 */
class MyOtherUserRepository implements IUserRepository
{
}
</pre>
<p>Using @Primary (or primary="true" in the @Component annotation) will tell the container that if more than 1 candidate is found
to be injected by type, then choose the one selected as the primary bean of that type.
</p>
<p>
You can also use this annotation in methods, like:
</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    protected $oneRepository;
    protected $otherBeans;

    /** @Inject */
    public function pleaseInjectMyRepository(IUserRepository $repository)
    {
        $this->oneRepository = $repository;
    }
    /** @Inject(name="otherBeans", type="SomeInterface[]") */
    public function pleaseInjectMyRepository(array $otherBeans)
    {
        $this->otherBeans = $otherBeans;
    }
}
</pre>
<p>Notice how the container automatically picks up the type of the argument of the method. The name of the method can be any, it wont matter
when injecting by type. This also applies to constructors:
</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    protected $oneRepository;
    protected $dependency;

    /** @Inject */
    public function __construct(IUserRepository $repository, IOtherInterface $dependency)
    {
        $this->oneRepository = $repository;
        $this->dependency = $dependency;
    }
}
</pre>
<p>In the above example, the container will try to inject a component of type IUserRepository and a component of type
IOtherInterface in the constructor arguments.
</p>
<p>You can also mix @Value and @Inject. In the following example, the constructor has 4 arguments (just as an example..), and
the arguments $repository and $dependency will be handled by the @Inject annotation, $otherArgument will be handled by the
second @Inject that specifies the name of the argument to be injected, and $aString will be handled by the @Value annotation:
</p>
<pre name="code" class="php">
/** @Component */
class MyBean
{
    protected $oneRepository;
    protected $dependency;
    protected $otherArgument;
    protected $aString;

    /**
     * @Inject
     * @Inject(name="otherArgument", type="SomeInterface[]")
     * @Value(name="aString", value="${user.property}")
     */
    public function __construct(
        IUserRepository $repository, IOtherInterface $dependency,
        array $otherArgument, $aString
    ) {
        $this->oneRepository = $repository;
        $this->dependency = $dependency;
        $this->otherArgument = $otherArgument;
        $this->aString = $aString;
    }
}
</pre>

              </div>
            </div>
            <div class="mod view-more">
              <div class="inner">
                <a href="articles.html">Read Other Articles</a>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
          <div id="sidebar" class="highlight articles-style original">
            <div class="mod simple">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
              	<h2>Articles</h2>
                <div class="hr-1"><hr /></div>
                <ul class="quick-list">
                  <li><a href="erlang_persistence_entities.html">Persisting your entities in Erlang</a></li>
                  <li><a href="erlang_rebar_coverage_on_subdirectories.html">Common Test: Code coverage on subdirectories</a></li>
                  <li><a href="erlang_special_processes_tutorial_handling_system_messages.html">Erlang Special Processes without behaviours</a></li>
                  <li><a href="erlang_websocket_server_cowboy_tutorial.html">Erlang Websocket Server using Cowboy</a></li>
                  <li><a href="making_your_ivr_nodes_call_flow_with_pagi_and_php_asterisk.html">Making your ivr nodes (call) flow with PAGI</a></li>
                  <li><a href="ci_jenkins_hudson_continuous_integration_php_phing.html">PHP Continuous integration, with Jenkins and Phing</a></li>
                  <li><a href="pagi_node_call_flow_easy_telephony_application_for_asterisk_php.html">Advanced telephony applications with PHP and PAGI using call flow nodes</a></li>
                  <li><a href="pagi_mock_client_unit_test_ivr_application_telephony_asterisk_agi.html">Unit test your PHP IVR applications with PAGI</a></li>
                  <li><a href="ding_component_bean_annotations.html">Ding bean annotations</a></li>
                  <li><a href="swig_php_libpcap_module_c++.html">Sniffing in PHP using libpcap: Thank you SWIG!</a></li>
                  <li><a href="ding_bean_lifecycle_init_destroy_post_construct.html">Hooks into the bean lifecycle in the Ding container</a></li>
                  <li><a href="php_asterisk_agi_protocol_tutorial.html">AGI (Asterisk Gateway Interface) Protocol Tutorial And Quick Practical Approach</a></li>
                  <li><a href="php_asterisk_manager_interface_protocol_tutorial_introduction.html">AMI (Asterisk Manager Interface) Protocol Tutorial</a></li>
                  <li><a href="php_send_dime_attachment_with_soap_webservice_with_curl.html">Using DIME With SOAP And PHP</a></li>
                  <li><a href="ding_php_aop_aspect_oriented_programming.html">Aspect Oriented Programming in PHP with Ding</a></li>
                  <li><a href="cross_freebsd_compiler_in_linux.html">Generating A Cross Compiler For Freebsd In Linux</a></li>
                  <li><a href="php_mock_global_functions_for_unit_tests_with_phpunit.html">Mocking Global Php 5.3 Functions Using Namespaces</a></li>
                  <li><a href="php_asterisk_listener_example_using_pami_and_ding.html">Making an Asterisk Manager Interface monitor using PHP, PAMI, and Ding (Inversion of control and dependency injection in your php telephony applications)</a></li>
                  <li><a href="bash_asterisk_manager_interface_client_shell_script.html">Bami: A Proof of concept asterisk manager interface (AMI) client written in bash</a></li>
                  <li><a href="configure_nginx_php_5.3_5.2_fastcgi.html">How to setup nginx to work with FastCGI and PHP 5.2 and PHP 5.3</a></li>
                  <li><a href="creating_php_cli_standalone_portable_applications_with_pear_dependencies.html"> Creating isolated environments for PHP applications with PEAR dependencies</a></li>
                  <li><a href="php_applications_with_doctrine2_orm_and_ding_di_container.html">Writing PHP applications with Doctrine2 as ORM and Ding as DI container</a></li>
                  <li><a href="configure_postfix_forward_all_email_smtp_gateway.html">Configuring postfix to forward all email to a smtp gateway</a></li>
                  <li><a href="ding_how_to_install_configure_tutorial_introduction.html">Installing and using the Ding DI Container</a></li>
                  <li><a href="pami_introduction_tutorial_how_to_install.html">Getting Started with the PAMI: PHP Asterisk Manager Interface</a></li>
                  <li><a href="pagi_tutorial_create_voip_telephony_application_for_asterisk_with_agi_and_php.html">PAGI: Quick telephony applications using AGI and PHP</a></li>
                  <li><a href="ding_event_listen_dispatch_bean.html">Dispatching and listening for events in the Ding container</a></li>
                  <li><a href="ding_example_xml_yaml_annotations_bean_drivers_tutorial_how_to.html">Ding container: Using the Xml, Yaml, and Annotations drivers</a></li>
                  <li><a href="ding_xml_yaml_di_dependency_injection.html">Dependency injection with Xml and Yaml in the Ding container</a></li>
                  <li><a href="configure_postfix_forward_email_regex_subject_transport_relay.html">Different relays in postfix based on regular expressions</a></li>
                </ul>
                <div class="google-ads">
                    <script type="text/javascript">
                    google_ad_client = "ca-pub-6947936742546167";
                    /* 9 */
                    google_ad_slot = "8617829895";
                    google_ad_width = 250;
                    google_ad_height = 250;
                    //-->
                    </script>
                    <script type="text/javascript"
                    src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                    </script>
                </div>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer">
  	<!-- <p>&copy; 2010 Marcelo G. All Rights Reserved. Website design by <a href="http://Digitallabs.tv" target="_blank">Digitallabs.tv</a></p> -->
    <address>Email: <a href="mailto:marcelog@gmail.com">marcelog@gmail.com</a></address>
  </div>
</div>

<!-- config SyntaxHighlighter -->
<script src='../dphighlighter/shCore.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushPhp.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushXml.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushJScript.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushCss.js' type='text/javascript'></script>
<script language="javascript">
    dp.SyntaxHighlighter.ClipboardSwf = '../dphighlighter/clipboard.swf';
    dp.SyntaxHighlighter.HighlightAll('code');
</script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21070993-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
