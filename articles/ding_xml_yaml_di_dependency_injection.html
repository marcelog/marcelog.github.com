<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>Dependency injection with Xml and Yaml in the Ding container</title>
<meta name="Author" content="Marcelo Gornstein"/>
<meta name="Keywords" content="ding php di container dependency injection bean xml yaml setter injection constructor injection properties arguments value"/>
<meta name="description" content="This article will show how to achieve dependency injection (di) in php by using the ding container, with the drivers xml and yaml"/>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../images/favicon.ico" title="favicon" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="all" />
<link href='../dphighlighter/SyntaxHighlighter.css' rel='stylesheet' type='text/css' />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="screen" href="../css/fix-ie.css" />
<![endif]-->
<!--[if IE 6]>
<script type="text/javascript" src="../js/fix-png.js"></script>
<![endif]-->
<script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script>
<script type="text/javascript" src="../js/lib/jquery-core.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
</head>
<body>
<div id="wrapper">
  <div id="top">
    <!-- <a class="logo" href="index.html">Marcelo G</a>-->
    <ul id="nav">
      <li><a href="../index.html"><span>Home</span></a></li>
      <li><a href="../about.html"><span>About</span></a></li>
      <li class="active"><a href="articles.html"><span>Articles</span></a></li>
      <li><a href="../software.html"><span>Software</span></a></li>
      <li><a href="mailto:marcelog@gmail.com"><span>Contact</span></a></li>
    </ul>
  </div>
  <div class="header">
  	<div class="line">
      <h1>Articles</h1>
      <div class="social-network">
       <a href="mailto:marcelog@gmail.com" class="icon-email" title="Email">Email</a>
       <g:plusone></g:plusone>
      </div>
   	</div>
    <div class="breadcrumb">You are here &nbsp;&raquo;&nbsp; <a href="../index.html">Home Page</a>  &nbsp;&raquo;&nbsp;  <a href="articles.html">Articles</a>  &nbsp;&raquo;&nbsp;  Dependency injection with Xml and Yaml in the Ding container</div>
  </div>
  <div class="main-outer">
  	<div class="main-inner">
    	<div class="main">
      	<div class="line">
          <div id="content">
            <div class="mod simple article-detail-style">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
                <h2>Dependency injection with Xml and Yaml in the Ding container</h2>
                <div class="hr-1"><hr /></div>
<h3>Introduction</h3>
<p>
In this <a href="http://marcelog.github.com/articles/ding_component_bean_annotations_di_dependency_injection.html">past article</a> I've discussed the
dependency injection features when using annotations. This time, we'll see how to use the xml and yaml drivers to do the same.
</p>
<p>In the <a href="http://marcelog.github.com/Ding/manual/toc.html#ioc">ding manual</a> you can find extensive examples (almost all with xml and annotations). You are encouraged to
take a look at if. This article will reproduce some of the examples there, extending the concepts a little bit, and giving some missing-from-the-manual YAML examples.</p>
<p>
Also, the manual explains other stuff not mentioned here, like bean aliasing and inheritance, hooking in the bean lifecycle, aspect oriented programming, 
factory beans and factory classes, etc.
</p>
<p>And, you can see the full examples for <a href="https://github.com/marcelog/Ding/tree/master/docs/examples/quickstart">xml</a> and <a href="https://github.com/marcelog/Ding/tree/master/docs/examples/yaml">yaml</a> at the Ding github repository.</p>

<h3>Setter Injection</h3>
<h4><u>Injecting scalar variables</u></h4>
<p>The general syntax for setter injection with xml is the following:</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;property name="someProperty"&gt;
      &lt;value&gt;aLiteralValue&lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<p>
Equivalent with YAML:
</p>
<pre name="code" class="xml">
beans: !!map
  myBeanName:
    class: MyBean
    properties: !!map
      someProperty:
        value: aLiteralValue
</pre>
<p>
You can also insert some special values, like "true", "false", or "null":
</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;property name="someNullProperty"&gt;
      &lt;null/&gt;
    &lt;/property&gt;
    &lt;property name="someTrueProperty"&gt;
      &lt;true/&gt;
    &lt;/property&gt;
    &lt;property name="someFalseProperty"&gt;
      &lt;false/&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<p>In YAML:</p>
<pre name="code" class="xml">
beans: !!map
  myBeanName:
    class: MyBean
    properties: !!map
      someNullProperty:
        value: null
      someTrueProperty:
        value: true
      someFalseProperty:
        value: false
</pre>
<h4><u>Injecting php code</u></h4>
<p>
Of course, doing this is not recommended. But if you really need to, you can execute code
and have the result injected as a property in your beans: 
</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;property name="someProperty"&gt;
      &lt;eval&gt;&lt;![CDATA[ return "Some evaluated code"; ]]&gt;&lt;/eval&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<p>
In YAML:
</p>
<pre name="code" class="xml">
beans: !!map
  myBeanName:
    class: MyBean
    properties: !!map
      someProperty:
        eval: return "Some evaluated code";
</pre>


<h4><u>Injecting user properties</u></h4>
<p>
You can also inject property values. In this case, we are injecting a property registered in the
<a href="http://marcelog.github.com/Ding/manual/toc.html#config">container or the properties holder</a>. In this case,
the container will inject the value of the property "user.name":
</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;property name="someProperty"&gt;
      &lt;value&gt;${user.name}&lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<p>
In YAML:
</p>
<pre name="code" class="xml">
beans: !!map
  myBeanName:
    class: MyBean
    properties: !!map
      someProperty:
        value: ${user.name}
</pre>
<h4><u>Injecting references to other beans (collaborators)</u></h4>
<p>
The usual case is the need to have a bean collaborating with another one. This translates into a bean
having a dependency on another bean (the collaborator). To achieve this:
</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="myOtherBeanName" class="MyCollaborator"/&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;property name="someProperty"&gt;
      &lt;ref bean="myOtherBeanName"/&gt;  
    &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<p>
In YAML:
</p>
<pre name="code" class="xml">
beans: !!map
  myOtherBeanName:
    class: MyCollaborator
  myBeanName:
    class: MyBean
    properties: !!map
      someProperty:
        ref: myOtherBeanName
</pre>
<p>
You can also define a collaborator in the actual property where it will be injected, instead of defining the collaborator
globally. This is useful to cleanup your xml/yaml files. These are called inner beans, which also, can be anonymous (i.e: without a given name):
</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;property name="someProperty"&gt;
      &lt;bean class="MyCollaborator"/&gt;  
    &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<p>
In YAML:
</p>
<pre name="code" class="xml">
beans: !!map
  myBeanName:
    class: MyBean
    properties: !!map
      someProperty:
        bean:
          class: MyCollaborator
</pre>
<p>
Being a bean definition themselves, you can have setter and constructor injection as well, and every other feature available when defining beans.
</p>
<h4><u>Injecting arrays</u></h4>
<p>
You can also inject arrays with values, specifying an optional key for each entry. In the following example, an associative array is 
injected, with several different values. Note how you can combine the syntax we saw above (remember, the array keys are completely optional):
</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;property name="someProperty"&gt;
      &lt;entry key="key1"&gt;
        &lt;value&gt;aLiteralValue&lt;/value&gt;
      &lt;/entry&gt;
      &lt;entry key="key2"&gt;
        &lt;value&gt;${user.name}&lt;/value&gt;
      &lt;/entry&gt;
      &lt;entry key="key3"&gt;
        &lt;bean class="MyCollaborator"/&gt;
      &lt;/entry&gt;
      &lt;entry key="key4"&gt;
        &lt;ref bean="otherBean"/&gt;
      &lt;/entry&gt;  
      &lt;entry key="key5"&gt;
        &lt;eval&gt;&lt;![CDATA[ return "Some evaluated code"; ]]>&lt;/eval&gt;
      &lt;/entry&gt;  
      &lt;entry key="key6"&gt;
        &lt;array&gt;
          &lt;entry&gt;
            &lt;value&gt;${aValue}&lt;/value&gt;
          &lt;/entry&gt;
        &lt;/array&gt;
      &lt;/entry&gt;  
    &lt;/property&gt;
&lt;/beans&gt;
</pre>
<p>In YAML:</p>
<pre name="code" class="xml">
beans: !!map
  myBeanName:
    class: MyBean
    properties: !!map
      someProperty:
        value: !!map
          key1: 
            value: aLiteralValue
          key2:
            value: ${user.name}
          key3:
            bean:
              class: MyCollaborator
          key4:
            ref: otherBean
          key5:
            eval: return "Some evaluated code";
          key6:
            value: !!map
              key:
                value: ${aValue}
</pre>
<h3>Constructor Injection</h3>
<p>Constructor injection is pretty much equal to setter injection. The syntax for declaring constructor arguments
is a little different, but you can use the same syntax to specify the values for the constructors. The constructor
arguments are evaluated IN ORDER. But you can optionally specify the "name" of the argument</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;constructor-arg&gt;
      &lt;value&gt;aLiteralValue&lt;/value&gt;
    &lt;/constructor-arg&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<p>Specifying constructor argument names:</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;constructor-arg name="argument1"&gt;
      &lt;value&gt;aLiteralValue&lt;/value&gt;
    &lt;/constructor-arg&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<p>In YAML you would do:</p>
<pre name="code" class="xml">
beans: !!map
  myBeanName:
    class: MyBean
    constructor-args:
      - aLiteralValue
</pre>
<pre name="code" class="xml">
beans: !!map
  myBeanName:
    class: MyBean
    constructor-args:
      argument1: aLiteralValue
</pre>
<p>Constructors can be injected with arrays, user properties, inner beans, etc. All what we saw for setters (properties) also apply to
constructors, so I wont go over it. Just try the same syntax as with setter injection :)</p>
<h3>Method Injection</h3>
<p>Method injection allows you to override a method in a given bean. In this case, the method "createDependency" in the bean
"myBeanName" will be overriden (by the container) with an implementation that returns the bean "dependencyName". 
</p>
<pre name="code" class="xml">
&lt;beans&gt;
  &lt;bean id="dependencyName" class="MyOtherBean" scope="prototype"/&gt;
  &lt;bean id="myBeanName" class="MyBean"&gt;
    &lt;lookup-method name="createDependency" bean="dependencyName"/&gt; 
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<p>In YAML:</p>
<pre name="code" class="xml">
beans: !!map
  myBeanName:
    class: MyBean
    lookup-methods: !!map
      createDependency: dependencyName
</pre>
<h3>Conclusions</h3>
<p>
XML and YAML can get quite verbose, that's why I personally preffer to use annotations. But, xml and yaml can be really handy
sometimes, and actually complements the annotations. Besides that, they provide a non-invasive way of configuring our dependencies, so that's
cool to have, too.
</p>
              </div>
            </div>
            <div class="mod view-more">
              <div class="inner">
                <a href="articles.html">Read Other Articles</a>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
          <div id="sidebar" class="highlight articles-style original">
            <div class="mod simple">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
              	<h2>Articles</h2>
                <div class="hr-1"><hr /></div>
                <ul class="quick-list">
                  <li><a href="ding_component_bean_annotations.html">Ding bean annotations</a></li>
                  <li><a href="swig_php_libpcap_module_c++.html">Sniffing in PHP using libpcap: Thank you SWIG!</a></li>
                  <li><a href="ding_bean_lifecycle_init_destroy_post_construct.html">Hooks into the bean lifecycle in the Ding container</a></li>
                  <li><a href="php_asterisk_agi_protocol_tutorial.html">AGI (Asterisk Gateway Interface) Protocol Tutorial And Quick Practical Approach</a></li>
                  <li><a href="php_asterisk_manager_interface_protocol_tutorial_introduction.html">AMI (Asterisk Manager Interface) Protocol Tutorial</a></li>
                  <li><a href="php_send_dime_attachment_with_soap_webservice_with_curl.html">Using DIME With SOAP And PHP</a></li>
                  <li><a href="ding_php_aop_aspect_oriented_programming.html">Aspect Oriented Programming in PHP with Ding</a></li>
                  <li><a href="cross_freebsd_compiler_in_linux.html">Generating A Cross Compiler For Freebsd In Linux</a></li>
                  <li><a href="php_mock_global_functions_for_unit_tests_with_phpunit.html">Mocking Global Php 5.3 Functions Using Namespaces</a></li>
                  <li><a href="php_asterisk_listener_example_using_pami_and_ding.html">Making an Asterisk Manager Interface monitor using PHP, PAMI, and Ding (Inversion of control and dependency injection in your php telephony applications)</a></li>
                  <li><a href="bash_asterisk_manager_interface_client_shell_script.html">Bami: A Proof of concept asterisk manager interface (AMI) client written in bash</a></li>
                  <li><a href="configure_nginx_php_5.3_5.2_fastcgi.html">How to setup nginx to work with FastCGI and PHP 5.2 and PHP 5.3</a></li>
                  <li><a href="creating_php_cli_standalone_portable_applications_with_pear_dependencies.html"> Creating isolated environments for PHP applications with PEAR dependencies</a></li>
                  <li><a href="php_applications_with_doctrine2_orm_and_ding_di_container.html">Writing PHP applications with Doctrine2 as ORM and Ding as DI container</a></li>
                  <li><a href="configure_postfix_forward_all_email_smtp_gateway.html">Configuring postfix to forward all email to a smtp gateway</a></li>
                  <li><a href="ding_how_to_install_configure_tutorial_introduction.html">Installing and using the Ding DI Container</a></li>
                  <li><a href="pami_introduction_tutorial_how_to_install.html">Getting Started with the PAMI: PHP Asterisk Manager Interface</a></li>
                  <li><a href="pagi_tutorial_create_voip_telephony_application_for_asterisk_with_agi_and_php.html">PAGI: Quick telephony applications using AGI and PHP</a></li>
                  <li><a href="ding_component_bean_annotations_di_dependency_injection.html">Ding annotations for dependency injection</a></li>
                  <li><a href="ding_event_listen_dispatch_bean.html">Dispatching and listening for events in the Ding container</a></li>
                  <li><a href="ding_example_xml_yaml_annotations_bean_drivers_tutorial_how_to.html">Ding container: Using the Xml, Yaml, and Annotations drivers</a></li>
                </ul>
                <div class="google-ads">
                    <script type="text/javascript">
                    google_ad_client = "ca-pub-6947936742546167";
                    /* 9 */
                    google_ad_slot = "8617829895";
                    google_ad_width = 250;
                    google_ad_height = 250;
                    //-->
                    </script>
                    <script type="text/javascript"
                    src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                    </script>
                </div>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer">
  	<!-- <p>&copy; 2010 Marcelo G. All Rights Reserved. Website design by <a href="http://Digitallabs.tv" target="_blank">Digitallabs.tv</a></p> -->
    <address>Email: <a href="mailto:marcelog@gmail.com">marcelog@gmail.com</a></address>
  </div>
</div>

<!-- config SyntaxHighlighter -->
<script src='../dphighlighter/shCore.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushPhp.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushXml.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushJScript.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushCss.js' type='text/javascript'></script>
<script language="javascript">
    dp.SyntaxHighlighter.ClipboardSwf = '../dphighlighter/clipboard.swf';
    dp.SyntaxHighlighter.HighlightAll('code');
</script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21070993-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
