<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>Automatized daily mysql backups to S3 buckets</title>
<meta name="Author" content="Marcelo Gornstein"/>
<meta name="Keywords" content="In this article I'll show a very simple way to make automatic daily backups of your mysql database to an amazon s3 bucket with a shell script in bash."/>
<meta name="description" content="In this article I'll show a very simple way to make automatic daily backups of your mysql database to an amazon s3 bucket with a shell script in bash."/>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../images/favicon.ico" title="favicon" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="all" />
<link href='../dphighlighter/SyntaxHighlighter.css' rel='stylesheet' type='text/css' />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="screen" href="../css/fix-ie.css" />
<![endif]-->
<!--[if IE 6]>
<script type="text/javascript" src="../js/fix-png.js"></script>
<![endif]-->
<script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script>
<script type="text/javascript" src="../js/lib/jquery-core.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
</head>
<body>
<div id="wrapper">
  <div id="top">
    <!-- <a class="logo" href="index.html">Marcelo G</a>-->
    <ul id="nav">
      <li><a href="../index.html"><span>Home</span></a></li>
      <!-- <li><a href="../about.html"><span>About</span></a></li> -->
      <li class="active"><a href="articles.html"><span>Articles</span></a></li>
      <li><a href="../software.html"><span>Software</span></a></li>
      <li><a href="mailto:marcelog@gmail.com"><span>Contact</span></a></li>
    </ul>
  </div>
  <div class="header">
    <div class="line">
      <h1>Articles</h1>
      <div class="social-network">
       <a href="mailto:marcelog@gmail.com" class="icon-email" title="Email">Email</a>
       <g:plusone></g:plusone>
      </div>
     </div>
    <div class="breadcrumb">You are here &nbsp;&raquo;&nbsp; <a href="../index.html">Home Page</a>  &nbsp;&raquo;&nbsp;  <a href="articles.html">Articles</a>  &nbsp;&raquo;&nbsp;  Automatized daily mysql backups to S3 buckets</div>
  </div>
  <div class="main-outer">
    <div class="main-inner">
      <div class="main">
        <div class="line">
          <div id="content">
            <div class="mod simple article-detail-style">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
                <h2>Automatized daily mysql backups to S3 buckets.</h2>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="mgornstein" data-size="large" data-related="mgornstein">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="hr-1"><hr /></div>
  <H3><u>Introduction</u></H3>
<p>
If you are not using <a href="https://aws.amazon.com/rds/"><b>RDS</b></a> to host your databases, it is very probable that you are doing your own
backups. In this article we'll see a very simple shell script to do <b>automatic daily backups</b> for your mysql databases into an <a href="https://aws.amazon.com/s3/"><b>S3 bucket</b></a>.
</p>
<h3>Requirements</h3>
<p>
  <ul>
    <li>An S3 bucket <a href="http://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html">created already</a></li>
    <li>A key/secret <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/using-iam-policies.html">that can access that bucket</a></li>
    <li><a href="https://aws.amazon.com/cli/">AWS Cli tools</a> installed</li>
  </ul>
</p>

<h3>The script</h3>
<p>
The idea is to create the following script and run it with the appropiate environment variables, and what it does is actually pretty simple.<br/><br/>
First, it gets the short name for the current day (let's say <b>mon</b>, for monday), and then uses <a href="https://dev.mysql.com/doc/refman/5.1/en/mysqldump.html"><b>mysqldump</b></a> to dump
the database to a temporary file. The file is then compressed with <a href="http://linux.die.net/man/1/gzip"><b>gzip</b></a> and last, it uploads the file to S3 by
using the <a href="http://docs.aws.amazon.com/cli/latest/reference/s3/index.html">AWS CLI Tools for S3</a>.
</p>
<p>
Note that this will allow you to have at most 7 backups, since every day the backup will overwrite the last backup corresponding to that day. You can change this
behavior easily by editing the <b>file</b> variable to suit your needs (perhaps using a format like <b>%Y-%m-%h</b>).
</p>
<pre name="code" class="php">
#!/bin/bash
cd /tmp
file=$(date +%a).sql
mysqldump \
  --host ${MYSQL_HOST} \
  --port ${MYSQL_PORT} \
  -u ${MYSQL_USER} \
  --password="${MYSQL_PASS}" \
  ${MYSQL_DB} > ${file}
if [ "${?}" -eq 0 ]; then
  gzip ${file}
  aws s3 cp ${file}.gz s3://${S3_BUCKET}
  rm ${file}.gz
else
  echo "Error backing up mysql"
  exit 255
fi
</pre>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6947936742546167"
     data-ad-slot="6142121850"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h3>Sample run</h3>
<pre name="code" class="php">
AWS_ACCESS_KEY_ID=my_key \
AWS_SECRET_ACCESS_KEY=my_secret \
AWS_DEFAULT_REGION=us-west-2 \
S3_BUCKET=my_bucket \
MYSQL_HOST=host \
MYSQL_PORT=port \
MYSQL_USER=myuser \
MYSQL_PASS=pass \
MYSQL_DB=db \
backup.sh
</pre>
<h3>Crontabing the script</h3>
<p>
Add the following line to your <a href="http://crontab.org/"><b>crontab</b></a>:
</p>
<pre name="code" class="php">
0 0 * * * root /usr/bin/my_backup.sh
</pre>
<p>
This will be run every day at 12:00am. Notice how we are not specifying any environment variables here. This is to prevent that
someone without enough privileges can see the passwords and other sensible information. The "crontabed"
script can be only accessible by root and hide the passwords and other needed information to do the backup.
</p>
<h3>Conclusion</h3>
<p>
Yeah, it is very simple, but highly effective :) Hopefully this will help you automate your daily backups for
you database.
</p>



              </div>
            </div>
            <div class="mod view-more">
              <div class="inner">
                <a href="articles.html">Read Other Articles</a>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
          <div id="sidebar" class="highlight articles-style original">
            <div class="mod simple">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
<p>
If you liked this or other articles (and feel generous), you can make a donation:
</p>
<p>
<a href='https://pledgie.com/campaigns/30947'><img alt='Click here to lend your support to: General and make a donation at pledgie.com !' src='https://pledgie.com/campaigns/30947.png?skin_name=chrome' border='0' ></a>
</p>
                <h2>Related Articles</h2>
                <div class="hr-1"><hr /></div>
                <ul class="quick-list">
                  <li><a href="aws_lambda_internet_vpc.html">Accessing the Internet and other AWS Resources in your VPC from AWS Lambda</a></li>
                  <li><a href="webrtc_with_asterisk_without_webrtc2sip.html">WebRTC with Asterisk and Amazon AWS</a></li>
                  <li><a href="restrict_block_acl_ip_address_haproxy_tcp.html">Using ACL by IP Address in HaProxy TCP Mode</a></li>
                  <li><a href="installing_webrtc2sip_in_amazon_linux_in_aws.html">Compiling and Installing WebRTC2SIP</a></li>
                  <li><a href="starting_webrtc2sip_as_service.html">Starting WebRTC2SIP as a service without screen or console</a></li>
                  <li><a href="cross_freebsd_compiler_in_linux.html">Generating A Cross Compiler For Freebsd In Linux</a></li>
                  <li><a href="configure_nginx_php_5.3_5.2_fastcgi.html">How to setup nginx to work with FastCGI and PHP 5.2 and PHP 5.3</a></li>
                  <li><a href="configure_postfix_forward_all_email_smtp_gateway.html">Configuring postfix to forward all email to a smtp gateway</a></li>
                  <li><a href="configure_postfix_forward_email_regex_subject_transport_relay.html">Different relays in postfix based on regular expressions</a></li>
                </ul>
                <div class="google-ads">
                    <script type="text/javascript">
                    google_ad_client = "ca-pub-6947936742546167";
                    /* 9 */
                    google_ad_slot = "8617829895";
                    google_ad_width = 250;
                    google_ad_height = 250;
                    //-->
                    </script>
                    <script type="text/javascript"
                    src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                    </script>
                </div>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer">
    <!-- <p>&copy; 2010 Marcelo G. All Rights Reserved. Website design by <a href="http://Digitallabs.tv" target="_blank">Digitallabs.tv</a></p> -->
    <address>Email: <a href="mailto:marcelog@gmail.com">marcelog@gmail.com</a></address>
  </div>
</div>

<!-- config SyntaxHighlighter -->
<script src='../dphighlighter/shCore.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushPhp.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushXml.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushJScript.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushCss.js' type='text/javascript'></script>
<script language="javascript">
    dp.SyntaxHighlighter.ClipboardSwf = '../dphighlighter/clipboard.swf';
    dp.SyntaxHighlighter.HighlightAll('code');
</script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21070993-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
