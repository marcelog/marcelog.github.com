<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>Installing DaemonTools in Amazon Linux (or CentOS like OS)</title>
<meta name="Author" content="Marcelo Gornstein"/>
<meta name="Keywords" content="This article explains how to install daemon tools from Daniel J. Bernstein in a modern Amazon Linux EC2 instance and/or any CentOS like linux distribution."/>
<meta name="description" content="This article explains how to install daemon tools from Daniel J. Bernstein in a modern Amazon Linux EC2 instance and/or any CentOS like linux distribution."/>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../images/favicon.ico" title="favicon" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="all" />
<link href='../dphighlighter/SyntaxHighlighter.css' rel='stylesheet' type='text/css' />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="screen" href="../css/fix-ie.css" />
<![endif]-->
<!--[if IE 6]>
<script type="text/javascript" src="../js/fix-png.js"></script>
<![endif]-->
<script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script>
<script type="text/javascript" src="../js/lib/jquery-core.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
</head>
<body>
<div id="wrapper">
  <div id="top">
    <!-- <a class="logo" href="index.html">Marcelo G</a>-->
    <ul id="nav">
      <li><a href="../index.html"><span>Home</span></a></li>
      <!-- <li><a href="../about.html"><span>About</span></a></li> -->
      <li class="active"><a href="articles.html"><span>Articles</span></a></li>
      <li><a href="../software.html"><span>Software</span></a></li>
      <li><a href="mailto:marcelog@gmail.com"><span>Contact</span></a></li>
    </ul>
  </div>
  <div class="header">
    <div class="line">
      <h1>Articles</h1>
      <div class="social-network">
       <a href="mailto:marcelog@gmail.com" class="icon-email" title="Email">Email</a>
       <g:plusone></g:plusone>
      </div>
     </div>
    <div class="breadcrumb">You are here &nbsp;&raquo;&nbsp; <a href="../index.html">Home Page</a>  &nbsp;&raquo;&nbsp;  <a href="articles.html">Articles</a>  &nbsp;&raquo;&nbsp;  Installing DaemonTools in Amazon Linux (or CentOS like OS)</div>
  </div>
  <div class="main-outer">
    <div class="main-inner">
      <div class="main">
        <div class="line">
          <div id="content">
            <div class="mod simple article-detail-style">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
                <h2>Installing DaemonTools in Amazon Linux (or CentOS like OS).</h2>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="mgornstein" data-size="large" data-related="mgornstein">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="hr-1"><hr /></div>
  <H3><u>Introduction</u></H3>
<p>
<a href="http://cr.yp.to/daemontools.html/"><b>DaemonTools</b></a> is an excellent piece of software created by <a href="https://en.wikipedia.org/wiki/Daniel_J._Bernstein">Daniel J. Bernstein</a>, and composed of several tools
used to launch and monitor processes in a unix environment. They are fast, reliable, and are my favourites whenever I get to wear the devops hat to setup a new server. Sadly, there's no default package
available for distros like Amazon Linux or CentOS, so here are the steps involved for setting them up manually.
</p>
<h3>Downloading</h3>
<pre name="code" class="php">
# cd /usr/src
# wget http://cr.yp.to/daemontools/daemontools-0.76.tar.gz
# tar -xzvf daemontools-0.76.tar.gz
</pre>
<h3>Patching for newest distributions</h3>
<p>
In modern operating distros, you will get the following error if you try to compile it right away:
</p>
<p>
<b>
/usr/bin/ld: errno: TLS definition in /lib64/libc.so.6 section .tbss mismatches non-TLS reference in envdir.o<br/>
/lib64/libc.so.6: could not read symbols: Bad value<br/>
collect2: error: ld returned 1 exit status<br/>
make: *** [envdir] Error 1<br/>
</b>
</p>
<p>
So if that's your case, apply the following patch like this:
</p>
<pre name="code" class="php">
# echo gcc -O2 -include /usr/include/errno.h > admin/daemontools-0.76/src/conf-cc
</pre>
<h3>Compiling and installing</h3>
<p>
After uncompressing and patching, we can start <b>compiling daemontools</b>:
<pre name="code" class="php">
# cd admin/daemontools-0.76/
# package/install
</pre>
<h3>Setting it up</h3>
<p>
Once built and installed, we need to start the <b>svscan</b> process when the
system starts so it can monitor and start our services. This is a simple way to
make <a href="http://upstart.ubuntu.com/">UpStart</a> start svscan on boot:
</p>
<pre name="code" class="php">
# echo "start on runlevel [12345]" > /etc/init/svscan.conf
# echo "respawn" >> /etc/init/svscan.conf
# echo "exec /command/svscanboot" >> /etc/init/svscan.conf
# initctl reload-configuration
# initctl start svscan
# ln -s /service /etc/service
</pre>
<p>
That's it! You can start writing your service scripts in <b>/etc/service</b>.
</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6947936742546167"
     data-ad-slot="6142121850"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h3>Service Example</h3>
<p>
Let's say we want <a href="http://jenkins-ci.org"><b>Jenkins</b></a> to be started
and monitored by daemontools. We would create a the following files and directories in a
temporary directory (let's say <b>/tmp</b>):
<ul>
  <li>/tmp/jenkins/log/run (mode 0700)</li>
  <li>/tmp/jenkins/env/JAVA_HOME (mode 0600)</li>
  <li>/tmp/jenkins/run (mode 0700)</li>
</ul>
</p>
<p>
The <b>env/JAVA_HOME</b> file would contain the path to where the JVM is installed:
</p>
<pre name="code" class="php">
/usr/java
</pre>
<p>
The <b>log/run</b> file could look like:
</p>
<pre name="code" class="php">
#!/bin/bash
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/command
exec 2>&1
mkdir -p /home/jenkins/log
chown -R jenkins:jenkins /home/jenkins/log
exec envuidgid jenkins multilog t s10485760 n5 '!tai64nlocal' /home/jenkins/log
</pre>
<p>
And the <b>run</b> file would look like:
</p>
<pre name="code" class="php">
#!/bin/bash
exec 2>&1
exec setuidgid jenkins envdir /etc/service/jenkins/env /usr/java/bin/java -Xmx2048m  -XX:MaxPermSize=2048m -Dhudson.plugins.git.GitSCM.verbose="true" -jar /home/jenkins/jenkins.war --httpPort=4433 --httpsPort=-1 --httpListenAddress=127.0.0.1 --logfile=/home/jenkins/log/jenkins.log
</pre>
<p>
Once we create all the files, we can just <b>mv /tmp/jenkins /etc/service</b> and Jenkins will be started instantaneously by
daemontools without further delay.
</p>
<p>
Enjoy!
</p>

              </div>
            </div>
            <div class="mod view-more">
              <div class="inner">
                <a href="articles.html">Read Other Articles</a>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
          <div id="sidebar" class="highlight articles-style original">
            <div class="mod simple">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
<p>
If you liked this or other articles (and feel generous), you can make a donation:
</p>
<p>
<a href='https://pledgie.com/campaigns/30947'><img alt='Click here to lend your support to: General and make a donation at pledgie.com !' src='https://pledgie.com/campaigns/30947.png?skin_name=chrome' border='0' ></a>
</p>
                <div class="google-ads">
                    <script type="text/javascript">
                    google_ad_client = "ca-pub-6947936742546167";
                    /* 9 */
                    google_ad_slot = "8617829895";
                    google_ad_width = 250;
                    google_ad_height = 250;
                    //-->
                    </script>
                    <script type="text/javascript"
                    src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                    </script>
                </div>
                <h2>Related Articles</h2>
                <div class="hr-1"><hr /></div>
                <ul class="quick-list">
                  <li><a href="webrtc_with_asterisk_without_webrtc2sip.html">WebRTC with Asterisk and Amazon AWS</a></li>
                  <li><a href="restrict_block_acl_ip_address_haproxy_tcp.html">Using ACL by IP Address in HaProxy TCP Mode</a></li>
                  <li><a href="simple_daily_mysql_backup_to_s3.html">Automatized daily mysql backups to S3 buckets</a></li>
                  <li><a href="installing_webrtc2sip_in_amazon_linux_in_aws.html">Compiling and Installing WebRTC2SIP</a></li>
                  <li><a href="starting_webrtc2sip_as_service.html">Starting WebRTC2SIP as a service without screen or console</a></li>
                  <li><a href="cross_freebsd_compiler_in_linux.html">Generating A Cross Compiler For Freebsd In Linux</a></li>
                  <li><a href="configure_nginx_php_5.3_5.2_fastcgi.html">How to setup nginx to work with FastCGI and PHP 5.2 and PHP 5.3</a></li>
                  <li><a href="configure_postfix_forward_all_email_smtp_gateway.html">Configuring postfix to forward all email to a smtp gateway</a></li>
                  <li><a href="configure_postfix_forward_email_regex_subject_transport_relay.html">Different relays in postfix based on regular expressions</a></li>
                </ul>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer">
    <!-- <p>&copy; 2010 Marcelo G. All Rights Reserved. Website design by <a href="http://Digitallabs.tv" target="_blank">Digitallabs.tv</a></p> -->
    <address>Email: <a href="mailto:marcelog@gmail.com">marcelog@gmail.com</a></address>
  </div>
</div>

<!-- config SyntaxHighlighter -->
<script src='../dphighlighter/shCore.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushPhp.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushXml.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushJScript.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushCss.js' type='text/javascript'></script>
<script language="javascript">
    dp.SyntaxHighlighter.ClipboardSwf = '../dphighlighter/clipboard.swf';
    dp.SyntaxHighlighter.HighlightAll('code');
</script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21070993-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
