<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>How to setup nginx to work with FastCGI and different (multiple) PHP versions</title>
<meta name="Author" content="Marcelo Gornstein"/>
<meta name="Keywords" content="How to setup nginx to work with FastCGI and PHP 5.2 and PHP 5.3"/>
<meta name="description" content="This article will show how to setup nginx to use fastcgi with different and multiple php versions, like 5.2 and 5.3 per virtual host"/>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../images/favicon.ico" title="favicon" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="all" />
<link href='../dphighlighter/SyntaxHighlighter.css' rel='stylesheet' type='text/css' />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="screen" href="../css/fix-ie.css" />
<![endif]-->
<!--[if IE 6]>
<script type="text/javascript" src="../js/fix-png.js"></script>
<![endif]-->
<script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script>
<script type="text/javascript" src="../js/lib/jquery-core.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
</head>
<body>
<div id="wrapper">
  <div id="top">
    <!-- <a class="logo" href="index.html">Marcelo G</a>-->
    <ul id="nav">
      <li><a href="../index.html"><span>Home</span></a></li>
      <li class="active"><a href="articles.html"><span>Articles</span></a></li>
      <li><a href="../software.html"><span>Software</span></a></li>
      <li><a href="mailto:marcelog@gmail.com"><span>Contact</span></a></li>
    </ul>
  </div>
  <div class="header">
  	<div class="line">
      <h1>Articles</h1>
      <div class="social-network">
       <a href="mailto:marcelog@gmail.com" class="icon-email" title="Email">Email</a>
       <g:plusone></g:plusone>
      </div>
   	</div>
    <div class="breadcrumb">You are here &nbsp;&raquo;&nbsp; <a href="../index.html">Home Page</a>  &nbsp;&raquo;&nbsp;  <a href="articles.html">Articles</a>  &nbsp;&raquo;&nbsp;  How to setup nginx to work with FastCGI and different (multiple) PHP versions</div>
  </div>
  <div class="main-outer">
  	<div class="main-inner">
    	<div class="main">
      	<div class="line">
          <div id="content">
            <div class="mod simple article-detail-style">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog2 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6947936742546167"
     data-ad-slot="2769853059"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
                <h2>How to setup nginx to work with FastCGI and different (multiple) PHP versions</h2>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="mgornstein" data-size="large" data-related="mgornstein">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="hr-1"><hr /></div>
  <H3><u>So you need to setup NGINX to run multiple PHP versions at once?</u></H3>
  <p>
<a href="http://nginx.org/"><b>Nginx</b></a> seems to be the new silver bullet nowadays, so I've decided
to give it a try. Of course it is fun to get it up and running and serve static content, but the
true fun is to see it replace <a href="http://httpd.apache.org"><b>Apache</b></a> or <a href="http://www.lighttpd.net/"><b>Lighttpd</b></a>
completely.
</p>
<p>And to make that happen, it has to support serving some dynamic content. In this article, I'll show
a very basic and quick setup for nginx, using <a href="http://en.wikipedia.org/wiki/FastCGI"><b>FastCGI</b></a> to serve
(in this particular case) PHP 5.2 and PHP 5.3 for different <b>virtual hosts</b> (<u>this will also work with other PHP versions too</u>).
  </p>
  <p>
The idea here, is to compile versions 5.2 and 5.3 of php with FastCGI enabled. Once we get that, we can launch
both fastcgi daemons and let nginx connect to them.
  </p>
  <H3><u>Configure and build PHP 5.2</u></H3>
  <p>
For PHP 5.2 you will need to configure (as in running ./configure before building) adding
the following options:
  </p>
<script src="https://gist.github.com/marcelog/ae61bb3167e08ca06fc087dddd4dc35d.js"></script>
  <H3><u>Configure and build PHP 5.3</u></H3>
  <p>
For PHP 5.3, the configuration options are slightly different:
  </p>
<script src="https://gist.github.com/marcelog/81b848ce56eb1eab7edc68bfad36cf75.js"></script>
  <p>
  This will let you run the php-cgi as a fastcgi daemon, by specifying -b address:port
  <p>
  See below.
  </p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6947936742546167"
     data-ad-slot="6142121850"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

  <H3><u>Setup your NGINX web server with FastCGI</u></H3>
  <p>
We're going to configure 2 <b>virtual hosts</b>, one for <b>PHP 5.2</b> and one for <b>PHP 5.3</b>. Each one of
these will access an exclusive <b>FastCGI daemon</b>, running the correct php version we need. Also, a sample
configuration is shown, to route all requests to non-existant files, to a front controller in
index.php (useful for <b>Zend Framework</b>, <b>Yii</b>, <b>Symfony</b>, etc).
  </p>
<script src="https://gist.github.com/marcelog/77eaba22a26a7136ab3a1c4fc63bb9e3.js"></script>
  <H3><u>Run multiple FastCGI daemons with different PHP versions</u></H3>
  <p>
This is a very silly script that will run your fastcgi daemons and nginx. Beware, this is just to show you
how it can be done, I recommend that you adapt this script to your OS, honoring the way init scripts are created
(freebsd has its own way, each linux flavor tend to have its own, etc)
  </p>
<script src="https://gist.github.com/marcelog/febe6681c99758c55b6bf9a8dfb2577d.js"></script>
<p>
That's it. Enjoy your php/nginx installation :)
</p>
              </div>
            </div>
            <div class="mod view-more">
              <div class="inner">
                <a href="articles.html">Read Other Articles</a>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
          <div id="sidebar" class="highlight articles-style original">
            <div class="mod simple">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
<p>
If you liked this or other articles (and feel generous), you can make a donation:
</p>
<p>
<a href='https://pledgie.com/campaigns/30947'><img alt='Click here to lend your support to: General and make a donation at pledgie.com !' src='https://pledgie.com/campaigns/30947.png?skin_name=chrome' border='0' ></a>
</p>
                <div class="google-ads">
                    <script type="text/javascript">
                    google_ad_client = "ca-pub-6947936742546167";
                    /* 9 */
                    google_ad_slot = "8617829895";
                    google_ad_width = 250;
                    google_ad_height = 250;
                    //-->
                    </script>
                    <script type="text/javascript"
                    src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                    </script>
                </div>
              	<h2>Related Articles</h2>
                <div class="hr-1"><hr /></div>
                <ul class="quick-list">
                  <li><a href="android_emulator_daemontools.html">Running the Android Emulator as System Services with Daemontools</a></li>
                  <li><a href="mac_newline_to_unix_eol.html">Convert MAC EOL to Unix</a></li>
                  <li><a href="nginx_compile_with_external_openssl.html">How to compile NGINX with external OpenSSL libraries and custom linker options</a></li>
                  <li><a href="webrtc_with_asterisk_without_webrtc2sip.html">WebRTC with Asterisk and Amazon AWS</a></li>
                  <li><a href="restrict_block_acl_ip_address_haproxy_tcp.html">Using ACL by IP Address in HaProxy TCP Mode</a></li>
                  <li><a href="simple_daily_mysql_backup_to_s3.html">Automatized daily mysql backups to S3 buckets</a></li>
                  <li><a href="installing_webrtc2sip_in_amazon_linux_in_aws.html">Compiling and Installing WebRTC2SIP</a></li>
                  <li><a href="install_daemon_tools_centos_amazon_linux.html">Installing DaemonTools in Amazon Linux (or CentOS like OS)</a></li>
                  <li><a href="starting_webrtc2sip_as_service.html">Starting WebRTC2SIP as a service without screen or console</a></li>
                  <li><a href="configure_postfix_forward_all_email_smtp_gateway.html">Configuring postfix to forward all email to a smtp gateway</a></li>
                  <li><a href="configure_postfix_forward_email_regex_subject_transport_relay.html">Different relays in postfix based on regular expressions</a></li>
                  <li><a href="cross_freebsd_compiler_in_linux.html">Generating A Cross Compiler For Freebsd In Linux</a></li>
                </ul>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer">
  	<!-- <p>&copy; 2010 Marcelo G. All Rights Reserved. Website design by <a href="http://Digitallabs.tv" target="_blank">Digitallabs.tv</a></p> -->
    <address>Email: <a href="mailto:marcelog@gmail.com">marcelog@gmail.com</a></address>
  </div>
</div>

<!-- config SyntaxHighlighter -->
<script src='../dphighlighter/shCore.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushPhp.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushXml.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushJScript.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushCss.js' type='text/javascript'></script>
<script language="javascript">
    dp.SyntaxHighlighter.ClipboardSwf = '../dphighlighter/clipboard.swf';
    dp.SyntaxHighlighter.HighlightAll('code');
</script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21070993-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>