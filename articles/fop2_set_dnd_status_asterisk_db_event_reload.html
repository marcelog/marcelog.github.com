<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>Setting DND (Do Not Disturb) in FOP2 Programmatically</title>
<meta name="Author" content="Marcelo Gornstein"/>
<meta name="Keywords" content="asterisk fop2 flash operator panel set do not disturb state in an extension dnd"/>
<meta name="description" content="This article shows how one can change an extension status in the Asterisk PBX and set it to DND or any other and show it in the FOP2 (Flash Operator Panel) panel."/>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../images/favicon.ico" title="favicon" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="all" />
<link href='../dphighlighter/SyntaxHighlighter.css' rel='stylesheet' type='text/css' />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="screen" href="../css/fix-ie.css" />
<![endif]-->
<!--[if IE 6]>
<script type="text/javascript" src="../js/fix-png.js"></script>
<![endif]-->
<script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script>
<script type="text/javascript" src="../js/lib/jquery-core.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
</head>
<body>
<div id="wrapper">
  <div id="top">
    <!-- <a class="logo" href="index.html">Marcelo G</a>-->
    <ul id="nav">
      <li><a href="../index.html"><span>Home</span></a></li>
      <li class="active"><a href="articles.html"><span>Articles</span></a></li>
      <li><a href="../software.html"><span>Software</span></a></li>
      <li><a href="mailto:marcelog@gmail.com"><span>Contact</span></a></li>
    </ul>
  </div>
  <div class="header">
    <div class="line">
      <h1>Articles</h1>
      <div class="social-network">
       <a href="mailto:marcelog@gmail.com" class="icon-email" title="Email">Email</a>
       <g:plusone></g:plusone>
      </div>
     </div>
    <div class="breadcrumb">You are here &nbsp;&raquo;&nbsp; <a href="../index.html">Home Page</a>  &nbsp;&raquo;&nbsp;  <a href="articles.html">Articles</a>  &nbsp;&raquo;&nbsp;  Setting DND (Do Not Disturb) in FOP2 Programmatically</div>
  </div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog2 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6947936742546167"
     data-ad-slot="2769853059"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <div class="main-outer">
    <div class="main-inner">
      <div class="main">
        <div class="line">
          <div id="content">
            <div class="mod simple article-detail-style">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
                <h2>Setting DND (Do Not Disturb) in FOP2 Programmatically</h2>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="mgornstein" data-size="large" data-related="mgornstein">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="hr-1"><hr /></div>
<h3>Change agents or extensions DND status in FOP2 by using plain Asterisk events</h3>
<p>
<a href="https://www.fop2.com/"><b>FOP2</b></a> (from Flash Operator Panel) is one of the most used graphical interfaces to the <a href="http://www.asterisk.org/"><b>AsteriskPBX</b></a>.
By using it we can see in realtime what is going on with the queues and extensions (or agents). In this article we're going to see how we
can integrate our systems with FOP2 so we can change the status of the extensions without using the graphical interface.
</p>
<h3>FOP2 Version required so DND can be set via Asterisk PBX Events</h3>
<p>
As a side note, you might want to use the latest FOP2 version (<a href="http://forum.fop2.com/4204-fop2-version-2-31-released">2.31</a> at this time). Each FOP2 release fixes
bugs in the previous versions and also takes into account new bugs/fixes in each Asterisk release.
</p>
<h3>Using the UserEvent action in Asterisk PBX to signal FOP2 about the DND change</h3>
<p>
FOP2 will pickup what you send in a <a href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+11+ManagerEvent_UserEvent">Custom UserEvent</a> with some specific values, and we can use this to our own advantage.
</p>
<p>
We can send our own custom events by using the <a href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+11+ManagerAction_UserEvent">Asterisk action UserEvent</a>, and the <a href="php_asterisk_manager_interface_protocol_tutorial_introduction.html">Asterisk Manager Interface connection to the Asterisk PBX</a> with these values:
</p>
<ul>
  <li><b>UserEvent</b>: "FOP2ASTDB"</li>
  <li><b>Family</b>: "fop2state"</li>
  <li><b>Value</b>: "Do not Disturb" (and we can also set this to a blank value to clear the DND status).</li>
  <li><b>Channel</b>: The SIP peer where you want to set DND.</li>
  </ul>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6947936742546167"
     data-ad-slot="6142121850"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h3>Using NAMI to set and unset DND status in FOP2 with Javascript code</h3>
<p>
We can also do this in plain javascript code, in this case from <a href="nodejs.org">NodeJS code</a> by using <a href="http://marcelog.github.io/Nami/">NAMI, which is a Javascript client for the AMI Protocol of the Asterisk PBX</a>.
</p>
<p>
In the following code, the NAMI client is being instantiated and used to connect to Asterisk. Afterwards, the UserEvent action is being sent with the right values to setup DND (Do not Disturb) status in the SIP/1000 peer.
</p>
<script src="https://gist.github.com/marcelog/d05eff5db439830ce41a84f01da40a5f.js"></script>
<p>
The same code can be used to clear the DND status if we leave the <b>Value</b> property as an empty string.
</p>
<h3>Control the FOP2 DND status in the agents or extensions from your own code</h3>
<p>
This opens up a lot of interesting possibilities for your own applications, since now you can control this in any way you like. For example, an operator would be able to change this via a web application, or perhaps an <a href="php_asterisk_agi_protocol_tutorial.html">AGI application, like an IVR</a> could change an extension status when it picks up a call.
</p>
              </div>
            </div>
            <div class="mod view-more">
              <div class="inner">
                <a href="articles.html">Read Other Articles</a>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
          <div id="sidebar" class="highlight articles-style original">
            <div class="mod simple">
              <span class="top"><span class="tl"></span><span class="tr"></span></span>
              <div class="inner set-height-1">
<p>
If you liked this or other articles (and feel generous), you can make a donation:
</p>
<p>
<a href='https://pledgie.com/campaigns/30947'><img alt='Click here to lend your support to: General and make a donation at pledgie.com !' src='https://pledgie.com/campaigns/30947.png?skin_name=chrome' border='0' ></a>
</p>
                <div class="google-ads">
                    <script type="text/javascript">
                    google_ad_client = "ca-pub-6947936742546167";
                    /* 9 */
                    google_ad_slot = "8617829895";
                    google_ad_width = 250;
                    google_ad_height = 250;
                    //-->
                    </script>
                    <script type="text/javascript"
                    src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                    </script>
                </div>
                <h2>Related Articles</h2>
                <div class="hr-1"><hr /></div>
                <ul class="quick-list">
                  <li><a href="aws_sns_hipchat_integration_notifications_with_lambda.html">Send HipChat Notifications with SNS and Lambda</a></li>
                  <li><a href="aws_get_tags_from_inside_instance_ec2.html">Get your AWS instance tags from your EC2 instance</a></li>
                  <li><a href="get_aws_instance_id_ec2_read_metadata.html">Getting the AWS instance ID from within the EC2 instance</a></li>
                  <li><a href="aws_lambda_internet_vpc.html">Accessing the Internet and other AWS Resources in your VPC from AWS Lambda</a></li>
                  <li><a href="simple_daily_mysql_backup_to_s3.html">Automatized daily mysql backups to S3 buckets</a></li>
                  <li><a href="installing_webrtc2sip_in_amazon_linux_in_aws.html">Compiling and Installing WebRTC2SIP</a></li>
                </ul>
              </div>
              <span class="bottom"><span class="bl"></span><span class="br"></span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer">
    <!-- <p>&copy; 2010 Marcelo G. All Rights Reserved. Website design by <a href="http://Digitallabs.tv" target="_blank">Digitallabs.tv</a></p> -->
    <address>Email: <a href="mailto:marcelog@gmail.com">marcelog@gmail.com</a></address>
  </div>
</div>

<!-- config SyntaxHighlighter -->
<script src='../dphighlighter/shCore.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushPhp.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushXml.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushJScript.js' type='text/javascript'></script>
<script src='../dphighlighter/shBrushCss.js' type='text/javascript'></script>
<script language="javascript">
    dp.SyntaxHighlighter.ClipboardSwf = '../dphighlighter/clipboard.swf';
    dp.SyntaxHighlighter.HighlightAll('code');
</script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21070993-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
